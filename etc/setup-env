#!/bin/bash

set -e

if [ `uname` == "Linux" ];then
    PYTHON_EXE=python
elif [ `uname` == "Darwin" ];then
    PYTHON_EXE=python.exe

    sed -i.bak s:/usr/local/ssl:`brew --prefix openssl`:g submodules/cpython/setup.py
else
    echo "Only GNU+Linux and OSX are supported"
    exit 1
fi


# build a debug version of CPython
pushd submodules/cpython
./configure --with-pydebug
make -j4
popd

# create a new virtualenv with our debug python build
./submodules/cpython/$PYTHON_EXE -m venv venv

# add the python gdb debug script next to python binary in the venv
cp submodules/cpython/Tools/gdb/libpython.py venv/bin/python-gdb.py

source venv/bin/activate
pip install ipython
pip install sphinx
pip install sphinx-rtd-theme

pushd tutorial
make html
popd
